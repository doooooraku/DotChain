import { create } from 'zustand';
import { persist, createJSONStorage } from 'zustand/middleware';
import AsyncStorage from '@react-native-async-storage/async-storage';
import * as Localization from 'expo-localization';

// 英語ベースのキーセット（文言の元）
const baseEn = {
  daysStreak: 'DAYS STREAK',
  yourChain: 'YOUR CHAIN',
  settings: 'Settings',
  hapticOff: 'Haptics off',
  language: 'Language',
  sound: 'Sound',
  haptics: 'Haptics',
  theme: 'Theme',
  restore: 'Restore Purchase',
  version: 'App Version',
  tapSound: 'Tap sound',
  click: 'Click',
  pop: 'Pop',
  freeThemeNote: 'Free: Dark only / Pro unlocks Neon Pink, Cyber Blue',
  proThemeNote: 'Pro themes unlock after paywall implementation.',
  restoreDesc: 'Restore Purchase (later)',
  licenses: 'Open Source Licenses (later)',
  openPro: 'Open DotChain Pro',
  heroPaywall: 'Upgrade to neon world',
  priceMonthly: '$2.99 / month',
  onboardingTitle: 'Welcome to DotChain',
  onboardingBody: 'One tap, heavy haptics. Let’s build today’s chain.',
  onboardingPunch: 'This is DotChain.',
  start: 'Get started',
  paywallNote: 'Billing/Ads will be added later.',
  // --- Home ---
  homeLoading: 'Loading...',
  homeAddHabitLabel: 'Add habit',
  // --- Edit ---
  editNewHabit: 'New Habit',
  editEditHabit: 'Edit Habit',
  editIconLabel: 'Icon',
  editNameLabel: 'Name (max 20 characters)',
  editNamePlaceholder: 'Name your habit...',
  editSaveChanges: 'Save Changes',
  editCreateHabit: 'Create Habit',
  editDeleteHabit: 'Delete Habit',
  // --- Pro ---
  proTitle: 'DotChain Pro',
  proHeaderTitle: 'DotChain Pro',
  proFeatureUnlimited: 'Unlimited habits',
  proFeatureThemes: 'All themes unlocked (Neon Pink / Cyber Blue)',
  proFeatureIcons: 'Custom app icon',
  proFeatureAds: 'No ads',
  // --- Accessibility ---
  habitButtonSuffix: ' habit button',
  // --- Errors ---
  errorLoadFailed: 'Failed to load data',
  errorTitleRequired: 'Title is required.',
  errorSaveFailed: 'Failed to save.',
  errorDeleteFailed: 'Failed to delete.',
  errorToggleFailed: 'Failed to update record.',
  // --- Settings description ---
  hapticsDescription: 'Haptic feedback',
};

// 正式訳（19言語）
const dictionaries = {
  en: baseEn,
  ja: {
    ...baseEn,
    daysStreak: '連続日数',
    yourChain: 'チェーン',
    settings: '設定',
    hapticOff: '振動オフ',
    language: '言語',
    sound: 'サウンド',
    haptics: '振動',
    theme: 'テーマ',
    restore: '購入を復元',
    version: 'アプリバージョン',
    tapSound: 'タップ音',
    click: 'クリック',
    pop: 'ポップ',
    freeThemeNote: '無料: ダークのみ / Proでネオンピンク・サイバーブルー解放',
    proThemeNote: 'Proテーマは課金実装後に解放されます。',
    restoreDesc: '購入を復元（後で実装）',
    licenses: 'OSSライセンス（後で表示）',
    openPro: 'DotChain Pro を開く',
    heroPaywall: 'ネオンの世界へアップグレード',
    priceMonthly: '$2.99 / 月',
    onboardingTitle: 'ようこそ DotChain へ',
    onboardingBody: '1タップでドンッと振動。今日のチェーンをつなげよう。',
    onboardingPunch: 'これが、DotChainです。',
    start: 'はじめる',
    paywallNote: '課金と広告は後から追加されます。',
    homeLoading: '読み込み中...',
    homeAddHabitLabel: '習慣を追加',
    editNewHabit: '新しい習慣',
    editEditHabit: '習慣の編集',
    editIconLabel: 'アイコン',
    editNameLabel: '習慣名（最大20文字）',
    editNamePlaceholder: '習慣の名前を入力...',
    editSaveChanges: '変更を保存',
    editCreateHabit: '習慣を作成',
    editDeleteHabit: '習慣を削除',
    proTitle: 'DotChain Pro',
    proHeaderTitle: 'DotChain Pro',
    proFeatureUnlimited: '習慣数 無制限',
    proFeatureThemes: '全テーマ解放（ネオンピンク / サイバーブルー）',
    proFeatureIcons: 'アプリアイコン変更',
    proFeatureAds: '広告非表示',
    habitButtonSuffix: 'の習慣ボタン',
    errorLoadFailed: 'データの読み込みに失敗しました。',
    errorTitleRequired: 'タイトルは必須です。',
    errorSaveFailed: '保存に失敗しました。',
    errorDeleteFailed: '削除に失敗しました。',
    errorToggleFailed: '記録の更新に失敗しました。',
    hapticsDescription: 'ハプティクス（振動）',
  },
  fr: {
    ...baseEn,
    daysStreak: 'JOURS DE SUITE',
    yourChain: 'TA CHAÎNE',
    settings: 'Réglages',
    hapticOff: 'Vibrations désactivées',
    language: 'Langue',
    sound: 'Son',
    haptics: 'Vibrations',
    theme: 'Thème',
    restore: 'Restaurer les achats',
    version: "Version de l’app",
    tapSound: 'Son du tap',
    click: 'Clic',
    pop: 'Pop',
    freeThemeNote: 'Gratuit : Dark uniquement / Pro déverrouille Neon Pink et Cyber Blue',
    proThemeNote: 'Les thèmes Pro seront activés après le paywall.',
    restoreDesc: 'Restaurer les achats (plus tard)',
    licenses: 'Licences open source (plus tard)',
    openPro: 'Ouvrir DotChain Pro',
    heroPaywall: 'Passe en mode néon',
    priceMonthly: '2,99 $ / mois',
    onboardingTitle: 'Bienvenue sur DotChain',
    onboardingBody: 'Un tap, grosse vibration. Construisons la chaîne du jour.',
    start: 'Commencer',
    paywallNote: 'Facturation/annonces ajoutées plus tard.',
    homeLoading: 'Chargement...',
    homeAddHabitLabel: 'Ajouter une habitude',
    editNewHabit: 'Nouvelle habitude',
    editEditHabit: "Modifier l'habitude",
    editIconLabel: 'Icône',
    editNameLabel: 'Nom (20 caractères max)',
    editNamePlaceholder: 'Nomme ton habitude...',
    editSaveChanges: 'Enregistrer',
    editCreateHabit: "Créer l'habitude",
    editDeleteHabit: "Supprimer l'habitude",
    proTitle: 'DotChain Pro',
    proHeaderTitle: 'DotChain Pro',
    proFeatureUnlimited: 'Habitudes illimitées',
    proFeatureThemes: 'Tous les thèmes débloqués (Neon Pink / Cyber Blue)',
    proFeatureIcons: "Icône d’app personnalisée",
    proFeatureAds: 'Sans publicité',
    habitButtonSuffix: " bouton d’habitude",
    errorLoadFailed: 'Échec du chargement des données',
    errorTitleRequired: 'Le titre est obligatoire.',
    errorSaveFailed: 'Échec de la sauvegarde.',
    errorDeleteFailed: 'Échec de la suppression.',
    errorToggleFailed: 'Échec de la mise à jour.',
    hapticsDescription: 'Retour haptique',
  },
  es: {
    ...baseEn,
    daysStreak: 'DÍAS SEGUIDOS',
    yourChain: 'TU CADENA',
    settings: 'Ajustes',
    hapticOff: 'Vibración desactivada',
    language: 'Idioma',
    sound: 'Sonido',
    haptics: 'Vibración',
    theme: 'Tema',
    restore: 'Restaurar compras',
    version: 'Versión de la app',
    tapSound: 'Sonido de toque',
    click: 'Clic',
    pop: 'Pop',
    freeThemeNote: 'Gratis: solo Dark / Pro desbloquea Neon Pink y Cyber Blue',
    proThemeNote: 'Los temas Pro se activarán tras el paywall.',
    restoreDesc: 'Restaurar compras (más adelante)',
    licenses: 'Licencias OSS (más adelante)',
    openPro: 'Abrir DotChain Pro',
    heroPaywall: 'Actualiza al mundo neón',
    priceMonthly: '$2.99 / mes',
    onboardingTitle: 'Bienvenido a DotChain',
    onboardingBody: 'Un toque, vibración fuerte. Construyamos la cadena de hoy.',
    start: 'Empezar',
    paywallNote: 'Facturación/Anuncios se añadirán después.',
    homeLoading: 'Cargando...',
    homeAddHabitLabel: 'Añadir hábito',
    editNewHabit: 'Nueva hábito',
    editEditHabit: 'Editar hábito',
    editIconLabel: 'Ícono',
    editNameLabel: 'Nombre (máx 20 caracteres)',
    editNamePlaceholder: 'Pon nombre a tu hábito...',
    editSaveChanges: 'Guardar cambios',
    editCreateHabit: 'Crear hábito',
    editDeleteHabit: 'Eliminar hábito',
    proTitle: 'DotChain Pro',
    proHeaderTitle: 'DotChain Pro',
    proFeatureUnlimited: 'Hábitos ilimitados',
    proFeatureThemes: 'Todos los temas desbloqueados (Neon Pink / Cyber Blue)',
    proFeatureIcons: 'Icono de app personalizado',
    proFeatureAds: 'Sin anuncios',
    habitButtonSuffix: ' botón de hábito',
    errorLoadFailed: 'Error al cargar datos',
    errorTitleRequired: 'El título es obligatorio.',
    errorSaveFailed: 'Error al guardar.',
    errorDeleteFailed: 'Error al eliminar.',
    errorToggleFailed: 'Error al actualizar.',
    hapticsDescription: 'Retroalimentación háptica',
  },
  de: {
    ...baseEn,
    daysStreak: 'TAGE IN FOLGE',
    yourChain: 'DEINE KETTE',
    settings: 'Einstellungen',
    hapticOff: 'Vibration aus',
    language: 'Sprache',
    sound: 'Sound',
    haptics: 'Vibration',
    theme: 'Theme',
    restore: 'Käufe wiederherstellen',
    version: 'App-Version',
    tapSound: 'Tippsound',
    click: 'Klick',
    pop: 'Plopp',
    freeThemeNote: 'Gratis: nur Dark / Pro schaltet Neon Pink & Cyber Blue frei',
    proThemeNote: 'Pro-Themes nach Paywall verfügbar.',
    restoreDesc: 'Wiederherstellen (später)',
    licenses: 'OSS-Lizenzen (später)',
    openPro: 'DotChain Pro öffnen',
    heroPaywall: 'Upgrade in die Neon-Welt',
    priceMonthly: '2,99 $ / Monat',
    onboardingTitle: 'Willkommen bei DotChain',
    onboardingBody: 'Ein Tap, starke Vibration. Lass uns die heutige Kette bauen.',
    start: 'Loslegen',
    paywallNote: 'Abrechnung/Ads kommen später.',
    homeLoading: 'Laden...',
    homeAddHabitLabel: 'Gewohnheit hinzufügen',
    editNewHabit: 'Neue Gewohnheit',
    editEditHabit: 'Gewohnheit bearbeiten',
    editIconLabel: 'Icon',
    editNameLabel: 'Name (max. 20 Zeichen)',
    editNamePlaceholder: 'Benenne deine Gewohnheit...',
    editSaveChanges: 'Änderungen speichern',
    editCreateHabit: 'Gewohnheit anlegen',
    editDeleteHabit: 'Gewohnheit löschen',
    proTitle: 'DotChain Pro',
    proHeaderTitle: 'DotChain Pro',
    proFeatureUnlimited: 'Unbegrenzte Gewohnheiten',
    proFeatureThemes: 'Alle Themes freigeschaltet (Neon Pink / Cyber Blue)',
    proFeatureIcons: 'Eigenes App-Icon',
    proFeatureAds: 'Keine Werbung',
    habitButtonSuffix: ' Gewohnheitsbutton',
    errorLoadFailed: 'Daten konnten nicht geladen werden',
    errorTitleRequired: 'Titel ist erforderlich.',
    errorSaveFailed: 'Speichern fehlgeschlagen.',
    errorDeleteFailed: 'Löschen fehlgeschlagen.',
    errorToggleFailed: 'Aktualisierung fehlgeschlagen.',
    hapticsDescription: 'Haptisches Feedback',
  },
  it: {
    ...baseEn,
    daysStreak: 'GIORNI DI FILA',
    yourChain: 'LA TUA CATENA',
    settings: 'Impostazioni',
    hapticOff: 'Vibrazione disattivata',
    language: 'Lingua',
    sound: 'Suono',
    haptics: 'Vibrazione',
    theme: 'Tema',
    restore: 'Ripristina acquisti',
    version: "Versione dell'app",
    tapSound: 'Suono tocco',
    click: 'Click',
    pop: 'Pop',
    freeThemeNote: 'Gratis: solo Dark / Pro sblocca Neon Pink, Cyber Blue',
    proThemeNote: 'Temi Pro attivi dopo il paywall.',
    restoreDesc: 'Ripristino (a breve)',
    licenses: 'Licenze OSS (a breve)',
    openPro: 'Apri DotChain Pro',
    heroPaywall: 'Passa al mondo neon',
    priceMonthly: '$2.99 / mese',
    onboardingTitle: 'Benvenuto su DotChain',
    onboardingBody: 'Un tap, vibrazione forte. Costruiamo la catena di oggi.',
    start: 'Inizia',
    paywallNote: 'Fatturazione/Ads più tardi.',
    homeLoading: 'Caricamento...',
    homeAddHabitLabel: 'Aggiungi abitudine',
    editNewHabit: 'Nuova abitudine',
    editEditHabit: 'Modifica abitudine',
    editIconLabel: 'Icona',
    editNameLabel: 'Nome (max 20 caratteri)',
    editNamePlaceholder: 'Dai un nome alla tua abitudine...',
    editSaveChanges: 'Salva modifiche',
    editCreateHabit: 'Crea abitudine',
    editDeleteHabit: 'Elimina abitudine',
    proTitle: 'DotChain Pro',
    proHeaderTitle: 'DotChain Pro',
    proFeatureUnlimited: 'Abitudini illimitate',
    proFeatureThemes: 'Tutti i temi sbloccati (Neon Pink / Cyber Blue)',
    proFeatureIcons: 'Icona app personalizzata',
    proFeatureAds: 'Nessuna pubblicità',
    habitButtonSuffix: ' pulsante abitudine',
    errorLoadFailed: 'Caricamento dei dati fallito',
    errorTitleRequired: 'Il titolo è obbligatorio.',
    errorSaveFailed: 'Salvataggio fallito.',
    errorDeleteFailed: 'Eliminazione fallita.',
    errorToggleFailed: 'Aggiornamento fallito.',
    hapticsDescription: 'Feedback aptico',
  },
  pt: {
    ...baseEn,
    daysStreak: 'DIAS SEGUIDOS',
    yourChain: 'SUA CORRENTE',
    settings: 'Configurações',
    hapticOff: 'Vibração desligada',
    language: 'Idioma',
    sound: 'Som',
    haptics: 'Vibração',
    theme: 'Tema',
    restore: 'Restaurar compras',
    version: 'Versão do app',
    tapSound: 'Som do toque',
    click: 'Clique',
    pop: 'Pop',
    freeThemeNote: 'Grátis: só Dark / Pro libera Neon Pink e Cyber Blue',
    proThemeNote: 'Temas Pro após o paywall.',
    restoreDesc: 'Restaurar (em breve)',
    licenses: 'Licenças OSS (em breve)',
    openPro: 'Abrir DotChain Pro',
    heroPaywall: 'Atualize para o mundo neon',
    priceMonthly: 'US$2.99 / mês',
    onboardingTitle: 'Bem-vindo ao DotChain',
    onboardingBody: 'Um toque, vibração forte. Vamos construir a cadeia de hoje.',
    start: 'Começar',
    paywallNote: 'Cobrança/Ads serão adicionadas depois.',
    homeLoading: 'Carregando...',
    homeAddHabitLabel: 'Adicionar hábito',
    editNewHabit: 'Novo hábito',
    editEditHabit: 'Editar hábito',
    editIconLabel: 'Ícone',
    editNameLabel: 'Nome (máx. 20 caracteres)',
    editNamePlaceholder: 'Nomeie seu hábito...',
    editSaveChanges: 'Salvar alterações',
    editCreateHabit: 'Criar hábito',
    editDeleteHabit: 'Excluir hábito',
    proTitle: 'DotChain Pro',
    proHeaderTitle: 'DotChain Pro',
    proFeatureUnlimited: 'Hábitos ilimitados',
    proFeatureThemes: 'Todos os temas liberados (Neon Pink / Cyber Blue)',
    proFeatureIcons: 'Ícone do app personalizado',
    proFeatureAds: 'Sem anúncios',
    habitButtonSuffix: ' botão de hábito',
    errorLoadFailed: 'Falha ao carregar dados',
    errorTitleRequired: 'Título é obrigatório.',
    errorSaveFailed: 'Falha ao salvar.',
    errorDeleteFailed: 'Falha ao excluir.',
    errorToggleFailed: 'Falha ao atualizar.',
    hapticsDescription: 'Feedback tátil',
  },
  ru: {
    ...baseEn,
    daysStreak: 'СЕРИЯ ДНЕЙ',
    yourChain: 'ТВОЯ ЦЕПЬ',
    settings: 'Настройки',
    hapticOff: 'Вибрация выключена',
    language: 'Язык',
    sound: 'Звук',
    haptics: 'Вибрация',
    theme: 'Тема',
    restore: 'Восстановить покупки',
    version: 'Версия приложения',
    tapSound: 'Звук нажатия',
    click: 'Клик',
    pop: 'Поп',
    freeThemeNote: 'Бесплатно: только Dark / Pro открывает Neon Pink, Cyber Blue',
    proThemeNote: 'Темы Pro будут доступны после paywall.',
    restoreDesc: 'Восстановление (скоро)',
    licenses: 'Лицензии OSS (скоро)',
    openPro: 'Открыть DotChain Pro',
    heroPaywall: 'В неоновый мир',
    priceMonthly: '$2.99 / месяц',
    onboardingTitle: 'Добро пожаловать в DotChain',
    onboardingBody: 'Одно нажатие — мощная вибрация. Соберём цепочку сегодня.',
    start: 'Начать',
    paywallNote: 'Биллинг/реклама позже.',
    homeLoading: 'Загрузка...',
    homeAddHabitLabel: 'Добавить привычку',
    editNewHabit: 'Новая привычка',
    editEditHabit: 'Редактировать привычку',
    editIconLabel: 'Иконка',
    editNameLabel: 'Название (до 20 символов)',
    editNamePlaceholder: 'Назови свою привычку...',
    editSaveChanges: 'Сохранить изменения',
    editCreateHabit: 'Создать привычку',
    editDeleteHabit: 'Удалить привычку',
    proTitle: 'DotChain Pro',
    proHeaderTitle: 'DotChain Pro',
    proFeatureUnlimited: 'Безлимитные привычки',
    proFeatureThemes: 'Все темы разблокированы (Neon Pink / Cyber Blue)',
    proFeatureIcons: 'Своя иконка приложения',
    proFeatureAds: 'Без рекламы',
    habitButtonSuffix: ' кнопка привычки',
    errorLoadFailed: 'Не удалось загрузить данные',
    errorTitleRequired: 'Требуется название.',
    errorSaveFailed: 'Не удалось сохранить.',
    errorDeleteFailed: 'Не удалось удалить.',
    errorToggleFailed: 'Не удалось обновить запись.',
    hapticsDescription: 'Тактильная отдача',
  },
  zh: {
    ...baseEn,
    daysStreak: '连续天数',
    yourChain: '你的链条',
    settings: '设置',
    hapticOff: '振动已关',
    language: '语言',
    sound: '声音',
    haptics: '振动',
    theme: '主题',
    restore: '恢复购买',
    version: '应用版本',
    tapSound: '点击声音',
    click: '点击',
    pop: '砰',
    freeThemeNote: '免费：仅暗色 / 专业版解锁霓虹粉和赛博蓝',
    proThemeNote: '专业主题将在付费后解锁。',
    restoreDesc: '恢复购买（稍后）',
    licenses: '开源许可（稍后）',
    openPro: '打开 DotChain Pro',
    heroPaywall: '升级到霓虹世界',
    priceMonthly: '$2.99 / 月',
    onboardingTitle: '欢迎使用 DotChain',
    onboardingBody: '一触即振，构建今天的链条。',
    start: '开始',
    paywallNote: '计费/广告稍后添加。',
    homeLoading: '加载中...',
    homeAddHabitLabel: '添加习惯',
    editNewHabit: '新增习惯',
    editEditHabit: '编辑习惯',
    editIconLabel: '图标',
    editNameLabel: '名称（最多20字符）',
    editNamePlaceholder: '为习惯命名...',
    editSaveChanges: '保存更改',
    editCreateHabit: '创建习惯',
    editDeleteHabit: '删除习惯',
    proTitle: 'DotChain Pro',
    proHeaderTitle: 'DotChain Pro',
    proFeatureUnlimited: '无限习惯',
    proFeatureThemes: '解锁所有主题（Neon Pink / Cyber Blue）',
    proFeatureIcons: '自定义应用图标',
    proFeatureAds: '无广告',
    habitButtonSuffix: ' 习惯按钮',
    errorLoadFailed: '数据加载失败',
    errorTitleRequired: '标题为必填项。',
    errorSaveFailed: '保存失败。',
    errorDeleteFailed: '删除失败。',
    errorToggleFailed: '更新失败。',
    hapticsDescription: '触觉反馈',
  },
  ko: {
    ...baseEn,
    daysStreak: '연속 일수',
    yourChain: '당신의 체인',
    settings: '설정',
    hapticOff: '진동 꺼짐',
    language: '언어',
    sound: '사운드',
    haptics: '진동',
    theme: '테마',
    restore: '구매 복원',
    version: '앱 버전',
    tapSound: '탭 사운드',
    click: '클릭',
    pop: '팝',
    freeThemeNote: '무료: 다크만 / Pro는 네온핑크·사이버블루 해제',
    proThemeNote: 'Pro 테마는 페이월 후 활성화.',
    restoreDesc: '구매 복원(추후)',
    licenses: 'OSS 라이선스(추후)',
    openPro: 'DotChain Pro 열기',
    heroPaywall: '네온 세계로 업그레이드',
    priceMonthly: '$2.99 / 월',
    onboardingTitle: 'DotChain에 오신 것을 환영합니다',
    onboardingBody: '한 번 탭, 강한 진동. 오늘의 체인을 쌓아요.',
    start: '시작하기',
    paywallNote: '결제/광고는 나중에 추가.',
    homeLoading: '로딩 중...',
    homeAddHabitLabel: '습관 추가',
    editNewHabit: '새 습관',
    editEditHabit: '습관 편집',
    editIconLabel: '아이콘',
    editNameLabel: '이름 (최대 20자)',
    editNamePlaceholder: '습관 이름을 입력...',
    editSaveChanges: '변경사항 저장',
    editCreateHabit: '습관 만들기',
    editDeleteHabit: '습관 삭제',
    proTitle: 'DotChain Pro',
    proHeaderTitle: 'DotChain Pro',
    proFeatureUnlimited: '무제한 습관',
    proFeatureThemes: '모든 테마 해제 (Neon Pink / Cyber Blue)',
    proFeatureIcons: '커스텀 앱 아이콘',
    proFeatureAds: '광고 없음',
    habitButtonSuffix: ' 습관 버튼',
    errorLoadFailed: '데이터 로드 실패',
    errorTitleRequired: '제목이 필요합니다.',
    errorSaveFailed: '저장 실패',
    errorDeleteFailed: '삭제 실패',
    errorToggleFailed: '업데이트 실패',
    hapticsDescription: '햅틱 피드백',
  },
  hi: {
    ...baseEn,
    daysStreak: 'लगातार दिन',
    yourChain: 'आपकी चेन',
    settings: 'सेटिंग्स',
    hapticOff: 'वाइब्रेशन बंद',
    language: 'भाषा',
    sound: 'साउंड',
    haptics: 'वाइब्रेशन',
    theme: 'थीम',
    restore: 'खरीद पुनर्स्थापित करें',
    version: 'ऐप संस्करण',
    tapSound: 'टैप साउंड',
    click: 'क्लिक',
    pop: 'पॉप',
    freeThemeNote: 'फ्री: केवल डार्क / प्रो से नीऑन पिंक, साइबर ब्लू खुलते हैं',
    proThemeNote: 'प्रो थीम पेवॉल के बाद सक्रिय होंगे।',
    restoreDesc: 'पुनर्स्थापन (जल्द)',
    licenses: 'ओएसएस लाइसेंस (जल्द)',
    openPro: 'DotChain Pro खोलें',
    heroPaywall: 'नीऑन दुनिया में अपग्रेड करें',
    priceMonthly: '$2.99 / माह',
    onboardingTitle: 'DotChain में स्वागत है',
    onboardingBody: 'एक टैप, तेज वाइब्रेशन। आज की चेन बनाएं।',
    start: 'शुरू करें',
    paywallNote: 'बिलिंग/ऐड बाद में।',
    homeLoading: 'लोड हो रहा है...',
    homeAddHabitLabel: 'आदत जोड़ें',
    editNewHabit: 'नई आदत',
    editEditHabit: 'आदत संपादित करें',
    editIconLabel: 'आइकन',
    editNameLabel: 'नाम (अधिकतम 20 अक्षर)',
    editNamePlaceholder: 'अपनी आदत का नाम लिखें...',
    editSaveChanges: 'परिवर्तन सहेजें',
    editCreateHabit: 'आदत बनाएं',
    editDeleteHabit: 'आदत हटाएं',
    proTitle: 'DotChain Pro',
    proHeaderTitle: 'DotChain Pro',
    proFeatureUnlimited: 'असीमित आदतें',
    proFeatureThemes: 'सभी थीम अनलॉक (Neon Pink / Cyber Blue)',
    proFeatureIcons: 'कस्टम ऐप आइकन',
    proFeatureAds: 'कोई विज्ञापन नहीं',
    habitButtonSuffix: ' आदत बटन',
    errorLoadFailed: 'डेटा लोड करने में विफल',
    errorTitleRequired: 'शीर्षक आवश्यक है।',
    errorSaveFailed: 'सहेजने में विफल।',
    errorDeleteFailed: 'हटाने में विफल।',
    errorToggleFailed: 'रिकॉर्ड अपडेट करने में विफल।',
    hapticsDescription: 'हैप्टिक फीडबैक',
  },
  id: {
    ...baseEn,
    daysStreak: 'HARI BERUNTUN',
    yourChain: 'RANTAI KAMU',
    settings: 'Pengaturan',
    hapticOff: 'Getar mati',
    language: 'Bahasa',
    sound: 'Suara',
    haptics: 'Getaran',
    theme: 'Tema',
    restore: 'Pulihkan pembelian',
    version: 'Versi aplikasi',
    tapSound: 'Suara tap',
    click: 'Klik',
    pop: 'Pop',
    freeThemeNote: 'Gratis: hanya Dark / Pro membuka Neon Pink & Cyber Blue',
    proThemeNote: 'Tema Pro aktif setelah paywall.',
    restoreDesc: 'Pulihkan (segera)',
    licenses: 'Lisensi OSS (segera)',
    openPro: 'Buka DotChain Pro',
    heroPaywall: 'Upgrade ke dunia neon',
    priceMonthly: '$2.99 / bulan',
    onboardingTitle: 'Selamat datang di DotChain',
    onboardingBody: 'Sekali tap, getaran kuat. Bangun rantai hari ini.',
    start: 'Mulai',
    paywallNote: 'Billing/iklan menyusul.',
    homeLoading: 'Memuat...',
    homeAddHabitLabel: 'Tambah kebiasaan',
    editNewHabit: 'Kebiasaan baru',
    editEditHabit: 'Edit kebiasaan',
    editIconLabel: 'Ikon',
    editNameLabel: 'Nama (maks 20 karakter)',
    editNamePlaceholder: 'Beri nama kebiasaanmu...',
    editSaveChanges: 'Simpan perubahan',
    editCreateHabit: 'Buat kebiasaan',
    editDeleteHabit: 'Hapus kebiasaan',
    proTitle: 'DotChain Pro',
    proHeaderTitle: 'DotChain Pro',
    proFeatureUnlimited: 'Kebiasaan tak terbatas',
    proFeatureThemes: 'Semua tema terbuka (Neon Pink / Cyber Blue)',
    proFeatureIcons: 'Ikon aplikasi kustom',
    proFeatureAds: 'Tanpa iklan',
    habitButtonSuffix: ' tombol kebiasaan',
    errorLoadFailed: 'Gagal memuat data',
    errorTitleRequired: 'Judul wajib diisi.',
    errorSaveFailed: 'Gagal menyimpan.',
    errorDeleteFailed: 'Gagal menghapus.',
    errorToggleFailed: 'Gagal memperbarui.',
    hapticsDescription: 'Umpan balik haptik',
  },
  th: {
    ...baseEn,
    daysStreak: 'จำนวนวันต่อเนื่อง',
    yourChain: 'โซ่ของคุณ',
    settings: 'การตั้งค่า',
    hapticOff: 'ปิดการสั่น',
    language: 'ภาษา',
    sound: 'เสียง',
    haptics: 'การสั่น',
    theme: 'ธีม',
    restore: 'กู้คืนการซื้อ',
    version: 'เวอร์ชันแอป',
    tapSound: 'เสียงแตะ',
    click: 'คลิก',
    pop: 'ป็อป',
    freeThemeNote: 'ฟรี: ธีมมืดเท่านั้น / Pro ปลดล็อก Neon Pink, Cyber Blue',
    proThemeNote: 'ธีม Pro จะใช้หลังเพย์วอลล์',
    restoreDesc: 'กู้คืน (เร็ว ๆ นี้)',
    licenses: 'สัญญาอนุญาต OSS (เร็ว ๆ นี้)',
    openPro: 'เปิด DotChain Pro',
    heroPaywall: 'อัปเกรดสู่โลกนีออน',
    priceMonthly: '$2.99 / เดือน',
    onboardingTitle: 'ยินดีต้อนรับสู่ DotChain',
    onboardingBody: 'แตะครั้งเดียว สั่นแรง สร้างโซ่ของวันนี้',
    start: 'เริ่ม',
    paywallNote: 'การชำระเงิน/โฆษณาจะเพิ่มภายหลัง',
    homeLoading: 'กำลังโหลด...',
    homeAddHabitLabel: 'เพิ่มนิสัย',
    editNewHabit: 'นิสัยใหม่',
    editEditHabit: 'แก้นิสัย',
    editIconLabel: 'ไอคอน',
    editNameLabel: 'ชื่อ (สูงสุด 20 ตัวอักษร)',
    editNamePlaceholder: 'ตั้งชื่อนิสัยของคุณ...',
    editSaveChanges: 'บันทึกการเปลี่ยนแปลง',
    editCreateHabit: 'สร้างนิสัย',
    editDeleteHabit: 'ลบนิสัย',
    proTitle: 'DotChain Pro',
    proHeaderTitle: 'DotChain Pro',
    proFeatureUnlimited: 'นิสัยไม่จำกัด',
    proFeatureThemes: 'ปลดล็อกทุกธีม (Neon Pink / Cyber Blue)',
    proFeatureIcons: 'ไอคอนแอปแบบกำหนดเอง',
    proFeatureAds: 'ไม่มีโฆษณา',
    habitButtonSuffix: ' ปุ่มนิสัย',
    errorLoadFailed: 'โหลดข้อมูลล้มเหลว',
    errorTitleRequired: 'ต้องใส่ชื่อเรื่อง',
    errorSaveFailed: 'บันทึกล้มเหลว',
    errorDeleteFailed: 'ลบล้มเหลว',
    errorToggleFailed: 'อัปเดตไม่สำเร็จ',
    hapticsDescription: 'การตอบสนองแบบสั่น',
  },
  vi: {
    ...baseEn,
    daysStreak: 'SỐ NGÀY LIÊN TIẾP',
    yourChain: 'CHUỖI CỦA BẠN',
    settings: 'Cài đặt',
    hapticOff: 'Rung tắt',
    language: 'Ngôn ngữ',
    sound: 'Âm thanh',
    haptics: 'Rung',
    theme: 'Chủ đề',
    restore: 'Khôi phục mua hàng',
    version: 'Phiên bản ứng dụng',
    tapSound: 'Âm chạm',
    click: 'Click',
    pop: 'Pop',
    freeThemeNote: 'Miễn phí: chỉ Dark / Pro mở Neon Pink & Cyber Blue',
    proThemeNote: 'Chủ đề Pro sau paywall.',
    restoreDesc: 'Khôi phục (sắp tới)',
    licenses: 'Giấy phép OSS (sắp tới)',
    openPro: 'Mở DotChain Pro',
    heroPaywall: 'Nâng cấp vào thế giới neon',
    priceMonthly: '$2.99 / tháng',
    onboardingTitle: 'Chào mừng đến DotChain',
    onboardingBody: 'Một chạm, rung mạnh. Xây chuỗi hôm nay.',
    start: 'Bắt đầu',
    paywallNote: 'Thanh toán/quảng cáo sẽ thêm sau.',
    homeLoading: 'Đang tải...',
    homeAddHabitLabel: 'Thêm thói quen',
    editNewHabit: 'Thói quen mới',
    editEditHabit: 'Chỉnh sửa thói quen',
    editIconLabel: 'Biểu tượng',
    editNameLabel: 'Tên (tối đa 20 ký tự)',
    editNamePlaceholder: 'Đặt tên thói quen...',
    editSaveChanges: 'Lưu thay đổi',
    editCreateHabit: 'Tạo thói quen',
    editDeleteHabit: 'Xóa thói quen',
    proTitle: 'DotChain Pro',
    proHeaderTitle: 'DotChain Pro',
    proFeatureUnlimited: 'Thói quen không giới hạn',
    proFeatureThemes: 'Mở khóa mọi chủ đề (Neon Pink / Cyber Blue)',
    proFeatureIcons: 'Biểu tượng ứng dụng tùy chỉnh',
    proFeatureAds: 'Không quảng cáo',
    habitButtonSuffix: ' nút thói quen',
    errorLoadFailed: 'Tải dữ liệu thất bại',
    errorTitleRequired: 'Cần tiêu đề.',
    errorSaveFailed: 'Lưu thất bại.',
    errorDeleteFailed: 'Xóa thất bại.',
    errorToggleFailed: 'Cập nhật thất bại.',
    hapticsDescription: 'Phản hồi rung',
  },
  ms: {
    ...baseEn,
    daysStreak: 'HARI BERTURUT',
    yourChain: 'RANTAI ANDA',
    settings: 'Tetapan',
    hapticOff: 'Getaran dimatikan',
    language: 'Bahasa',
    sound: 'Bunyi',
    haptics: 'Getaran',
    theme: 'Tema',
    restore: 'Pulihkan pembelian',
    version: 'Versi aplikasi',
    tapSound: 'Bunyi ketukan',
    click: 'Klik',
    pop: 'Pop',
    freeThemeNote: 'Percuma: Dark sahaja / Pro buka Neon Pink & Cyber Blue',
    proThemeNote: 'Tema Pro selepas paywall.',
    restoreDesc: 'Pulih (akan datang)',
    licenses: 'Lesen OSS (akan datang)',
    openPro: 'Buka DotChain Pro',
    heroPaywall: 'Tingkatkan ke dunia neon',
    priceMonthly: '$2.99 / bulan',
    onboardingTitle: 'Selamat datang ke DotChain',
    onboardingBody: 'Satu ketukan, getaran kuat. Bina rantai hari ini.',
    start: 'Mula',
    paywallNote: 'Pengebilan/iklan kemudian.',
    homeLoading: 'Memuat...',
    homeAddHabitLabel: 'Tambah tabiat',
    editNewHabit: 'Tabiat baharu',
    editEditHabit: 'Edit tabiat',
    editIconLabel: 'Ikon',
    editNameLabel: 'Nama (maks 20 aksara)',
    editNamePlaceholder: 'Namakan tabiat anda...',
    editSaveChanges: 'Simpan perubahan',
    editCreateHabit: 'Cipta tabiat',
    editDeleteHabit: 'Padam tabiat',
    proTitle: 'DotChain Pro',
    proHeaderTitle: 'DotChain Pro',
    proFeatureUnlimited: 'Tabiat tanpa had',
    proFeatureThemes: 'Semua tema dibuka (Neon Pink / Cyber Blue)',
    proFeatureIcons: 'Ikon aplikasi tersuai',
    proFeatureAds: 'Tiada iklan',
    habitButtonSuffix: ' butang tabiat',
    errorLoadFailed: 'Gagal memuatkan data',
    errorTitleRequired: 'Tajuk diperlukan.',
    errorSaveFailed: 'Gagal menyimpan.',
    errorDeleteFailed: 'Gagal memadam.',
    errorToggleFailed: 'Gagal mengemas kini.',
    hapticsDescription: 'Maklum balas haptik',
  },
  tr: {
    ...baseEn,
    daysStreak: 'GÜN SERİSİ',
    yourChain: 'ZİNCİRİN',
    settings: 'Ayarlar',
    hapticOff: 'Titreşim kapalı',
    language: 'Dil',
    sound: 'Ses',
    haptics: 'Titreşim',
    theme: 'Tema',
    restore: 'Satın alımı geri yükle',
    version: 'Uygulama sürümü',
    tapSound: 'Dokunma sesi',
    click: 'Tık',
    pop: 'Pop',
    freeThemeNote: 'Ücretsiz: yalnızca Dark / Pro Neon Pink, Cyber Blue açar',
    proThemeNote: 'Pro temalar paywall sonrası.',
    restoreDesc: 'Geri yükleme (yakında)',
    licenses: 'OSS lisansları (yakında)',
    openPro: "DotChain Pro'yu aç",
    heroPaywall: 'Neon dünyasına geç',
    priceMonthly: '$2.99 / ay',
    onboardingTitle: "DotChain'e hoş geldin",
    onboardingBody: 'Tek dokunuş, güçlü titreşim. Bugünün zincirini kur.',
    start: 'Başla',
    paywallNote: 'Faturalama/reklam sonra.',
    homeLoading: 'Yükleniyor...',
    homeAddHabitLabel: 'Alışkanlık ekle',
    editNewHabit: 'Yeni alışkanlık',
    editEditHabit: 'Alışkanlık düzenle',
    editIconLabel: 'İkon',
    editNameLabel: 'Ad (en fazla 20 karakter)',
    editNamePlaceholder: 'Alışkanlığına ad ver...',
    editSaveChanges: 'Değişiklikleri kaydet',
    editCreateHabit: 'Alışkanlık oluştur',
    editDeleteHabit: 'Alışkanlığı sil',
    proTitle: 'DotChain Pro',
    proHeaderTitle: 'DotChain Pro',
    proFeatureUnlimited: 'Sınırsız alışkanlık',
    proFeatureThemes: 'Tüm temalar açık (Neon Pink / Cyber Blue)',
    proFeatureIcons: 'Özel uygulama ikonu',
    proFeatureAds: 'Reklamsız',
    habitButtonSuffix: ' alışkanlık düğmesi',
    errorLoadFailed: 'Veri yüklenemedi',
    errorTitleRequired: 'Başlık gerekli.',
    errorSaveFailed: 'Kaydetme başarısız.',
    errorDeleteFailed: 'Silme başarısız.',
    errorToggleFailed: 'Güncelleme başarısız.',
    hapticsDescription: 'Dokunsal geri bildirim',
  },
  nl: {
    ...baseEn,
    daysStreak: 'DAGEN OP RIJ',
    yourChain: 'JOUW KETEN',
    settings: 'Instellingen',
    hapticOff: 'Trillen uit',
    language: 'Taal',
    sound: 'Geluid',
    haptics: 'Trillen',
    theme: 'Thema',
    restore: 'Aankopen herstellen',
    version: 'App-versie',
    tapSound: 'Tikgeluid',
    click: 'Klik',
    pop: 'Pop',
    freeThemeNote: 'Gratis: alleen Donker / Pro ontgrendelt Neon Pink & Cyber Blue',
    proThemeNote: 'Pro-thema\'s na paywall.',
    restoreDesc: 'Herstellen (binnenkort)',
    licenses: 'OSS-licenties (binnenkort)',
    openPro: 'Open DotChain Pro',
    heroPaywall: 'Upgrade naar de neonwereld',
    priceMonthly: '$2.99 / maand',
    onboardingTitle: 'Welkom bij DotChain',
    onboardingBody: 'Eén tik, sterke trilling. Bouw de keten van vandaag.',
    start: 'Start',
    paywallNote: 'Facturatie/ads later.',
    homeLoading: 'Bezig met laden...',
    homeAddHabitLabel: 'Gewoonte toevoegen',
    editNewHabit: 'Nieuwe gewoonte',
    editEditHabit: 'Gewoonte bewerken',
    editIconLabel: 'Pictogram',
    editNameLabel: 'Naam (max 20 tekens)',
    editNamePlaceholder: 'Geef je gewoonte een naam...',
    editSaveChanges: 'Wijzigingen opslaan',
    editCreateHabit: 'Gewoonte maken',
    editDeleteHabit: 'Gewoonte verwijderen',
    proTitle: 'DotChain Pro',
    proHeaderTitle: 'DotChain Pro',
    proFeatureUnlimited: 'Onbeperkte gewoonten',
    proFeatureThemes: 'Alle thema’s ontgrendeld (Neon Pink / Cyber Blue)',
    proFeatureIcons: 'Aangepaste app-icon',
    proFeatureAds: 'Geen advertenties',
    habitButtonSuffix: ' gewoonteknop',
    errorLoadFailed: 'Gegevens laden mislukt',
    errorTitleRequired: 'Titel is verplicht.',
    errorSaveFailed: 'Opslaan mislukt.',
    errorDeleteFailed: 'Verwijderen mislukt.',
    errorToggleFailed: 'Bijwerken mislukt.',
    hapticsDescription: 'Haptische feedback',
  },
  sv: {
    ...baseEn,
    daysStreak: 'DAGAR I RAD',
    yourChain: 'DIN KEDJA',
    settings: 'Inställningar',
    hapticOff: 'Vibration av',
    language: 'Språk',
    sound: 'Ljud',
    haptics: 'Vibration',
    theme: 'Tema',
    restore: 'Återställ köp',
    version: 'App-version',
    tapSound: 'Tryckljud',
    click: 'Klick',
    pop: 'Pop',
    freeThemeNote: 'Gratis: bara Dark / Pro låser upp Neon Pink & Cyber Blue',
    proThemeNote: 'Pro-teman efter paywall.',
    restoreDesc: 'Återställ (snart)',
    licenses: 'OSS-licenser (snart)',
    openPro: 'Öppna DotChain Pro',
    heroPaywall: 'Uppgradera till neonvärlden',
    priceMonthly: '$2.99 / månad',
    onboardingTitle: 'Välkommen till DotChain',
    onboardingBody: 'Ett tryck, stark vibration. Bygg dagens kedja.',
    start: 'Starta',
    paywallNote: 'Fakturering/annonser senare.',
    homeLoading: 'Laddar...',
    homeAddHabitLabel: 'Lägg till vana',
    editNewHabit: 'Ny vana',
    editEditHabit: 'Redigera vana',
    editIconLabel: 'Ikon',
    editNameLabel: 'Namn (max 20 tecken)',
    editNamePlaceholder: 'Namnge din vana...',
    editSaveChanges: 'Spara ändringar',
    editCreateHabit: 'Skapa vana',
    editDeleteHabit: 'Ta bort vana',
    proTitle: 'DotChain Pro',
    proHeaderTitle: 'DotChain Pro',
    proFeatureUnlimited: 'Obegränsade vanor',
    proFeatureThemes: 'Alla teman upplåsta (Neon Pink / Cyber Blue)',
    proFeatureIcons: 'Egen appikon',
    proFeatureAds: 'Inga annonser',
    habitButtonSuffix: ' vaneknapp',
    errorLoadFailed: 'Misslyckades att läsa in data',
    errorTitleRequired: 'Titel krävs.',
    errorSaveFailed: 'Misslyckades att spara.',
    errorDeleteFailed: 'Misslyckades att ta bort.',
    errorToggleFailed: 'Misslyckades att uppdatera.',
    hapticsDescription: 'Haptisk feedback',
  },
};

export type Lang = keyof typeof dictionaries;

type I18nState = {
  lang: Lang;
  setLang: (lang: Lang) => void;
};

const isSupportedLang = (code?: string): code is Lang => {
  if (!code) return false;
  return code in dictionaries;
};

const detectInitialLang = (): Lang => {
  try {
    const locales = Localization.getLocales();
    const primary = locales?.[0];
    const code = primary?.languageCode?.toLowerCase();
    if (isSupportedLang(code)) return code;
    return 'en';
  } catch {
    return 'en';
  }
};

const useI18nStore = create<I18nState>()(
  persist(
    (set) => ({
      lang: detectInitialLang(),
      setLang: (lang) => set({ lang: isSupportedLang(lang) ? lang : 'en' }),
    }),
    {
      name: 'dotchain-i18n',
      storage: createJSONStorage(() => AsyncStorage),
    },
  ),
);

export function useTranslation() {
  const lang = useI18nStore((s) => s.lang);
  const setLang = useI18nStore((s) => s.setLang);
  const t = (key: keyof typeof baseEn) => dictionaries[lang][key] ?? key;
  return { t, lang, setLang };
}

export function setLang(lang: Lang) {
  useI18nStore.getState().setLang(lang);
}

export function getLang(): Lang {
  return useI18nStore.getState().lang;
}

export function tAll() {
  const lang = useI18nStore.getState().lang;
  return dictionaries[lang];
}

export function t(key: keyof typeof baseEn) {
  const lang = useI18nStore.getState().lang;
  return dictionaries[lang][key] ?? key;
}
