

# 5\_テスト仕様書.md（DotChain）

## 1\. はじめに

### 1.1 本書の目的

このドキュメントは、完成したアプリ「DotChain」が、**世界中の誰が、どんな状況で使っても「最高に気持ちいい」状態か**を確認するための「最終試験問題集」です。

  - **0\_プロダクト戦略**: コンセプト通りの「快感」があるか？
  - **1\_基本仕様書**: 必要な機能は揃っているか？
  - **2\_機能設計書**: 裏側の処理は正しいか？
  - **6\_法務・セキュリティ**: ルールを守っているか？

これらを厳しくチェックし、**全てに合格しない限り、絶対にリリースしません。**

### 1.2 テスト対象

  - **アプリ名**: DotChain (v1.0.0)
  - **プラットフォーム**:
      - iOS: iOS 15.0 以上
      - Android: Android 10.0 以上

### 1.3 テストの種類（レベル）

1.  **自動テスト (Automated)**: コンピュータが高速で行う計算チェック。
2.  **手動テスト (Manual)**: 人間が実際に指で触って行う「感触」や「見た目」のチェック。

-----

## 2\. テスト環境（準備するもの）

### 2.1 デバイスマトリクス（必須端末）

DotChainは「振動（Haptics）」と「有機ELの黒（OLED Black）」が命です。シミュレーターだけでなく、必ず実機で確認します。

| 種類 | 端末例 | 確認するポイント |
| :--- | :--- | :--- |
| **実機 iOS** | iPhone 12以降 | **振動の質**、ノッチ（画面上の切り欠き）の表示、FaceID購入フロー。 |
| **実機 Android** | Pixel 6以降 | **振動の質**、戻るジェスチャー、ウィジェットの動作。 |
| **小型端末** | iPhone SE / mini | 画面が小さくてもボタンがはみ出さないか。 |
| **古いOS** | Android 10 / 11 | 古いスマホでも動作が重くないか。 |

### 2.2 テスト用アカウント・設定

  * **RevenueCat**: Sandbox（テスト環境）ユーザーを使用。
  * **AdMob**: テスト用広告IDを使用（本物の広告を表示するとアカウント停止リスクがあるため）。
  * **機内モード**: オフラインテスト用。

-----

## 3\. 自動テスト実行コマンド

開発者がリリース前に必ず実行するコマンドです。

### 3.1 `pnpm lint` (文法チェック)

  * **意味**: プログラムの書き方に間違いがないか、先生（ESLint）に見てもらうコマンド。
  * **合格基準**: エラー(Error)も警告(Warning)もゼロであること。

### 3.2 `pnpm test` (単体テスト)

  * **意味**: 計算ドリル。連続達成日数（Streak）の計算などが合っているかチェックする。
  * **合格基準**: 全てのテストケースが `PASS`（緑色）になること。

### 3.3 `pnpm test:e2e` (E2Eテスト)

  * **意味**: ロボット（Maestro）にアプリを操作させるテスト。
  * **シナリオ**: `maestro/flows/smoke.yaml`
    1.  アプリ起動
    2.  習慣ボタンをタップ
    3.  設定画面を開く
    4.  アプリ終了
  * **合格基準**: 途中で止まらずに最後まで完走すること。

-----

## 4\. 機能別 手動テストケース一覧

ここが本番です。人間の五感を使って確認します。

### F-01: ワンタップ記録 (Record) - ★最重要

| テストID | テスト項目名 | 優先度 | 手順と確認内容 |
| :--- | :--- | :--- | :--- |
| **TC-F01-01** | **快感の即時性** | **P1** | ボタンをタップする。<br>→ \*\*指が離れる前（0.1秒以内）\*\*に「コンッ」と振動し、音が鳴ること。<br>→ 保存待ちのラグ（遅れ）が一切ないこと。 |
| **TC-F01-02** | **音楽との共存** | **P1** | **Spotify等で音楽を聴きながら**アプリを使い、ボタンを押す。<br>→ 音楽が止まったり、音量が下がったりしないこと（Mixモード確認）。 |
| **TC-F01-03** | **マナーモード** | **P2** | 本体のサイレントスイッチをONにしてボタンを押す。<br>→ 音は鳴らず、**振動だけ**がすること。 |
| **TC-F01-04** | **連打耐久** | **P2** | ボタンを1秒間に5回くらい連打する。<br>→ アプリが落ちず、音が重なって再生され、最終的な状態（完了/未完了）が正しいこと。 |

### F-02: 習慣管理 (Manage)

| テストID | テスト項目名 | 優先度 | 手順と確認内容 |
| :--- | :--- | :--- | :--- |
| **TC-F02-01** | **新規追加** | **P1** | 新しい習慣を追加する。<br>→ ホーム画面の末尾に追加され、アイコンと名前が正しいこと。 |
| **TC-F02-02** | **削除の挙動** | **P2** | 編集画面から削除を行う。<br>→ ホーム画面から即座に消え、ヒートマップのデータも消えること。 |
| **TC-F02-03** | **無料制限** | **P1** | (Free版) 4つ目の習慣を追加しようとする。<br>→ \*\*課金画面（Paywall）\*\*がスムーズに表示されること。 |

### F-03: 多言語・RTL対応 (Localization) - ★DotChainの肝

| テストID | テスト項目名 | 優先度 | 手順と確認内容 |
| :--- | :--- | :--- | :--- |
| **TC-F03-01** | **アラビア語反転** | **P1** | 設定で「Arabic」を選ぶ。<br>→ アプリ再起動なしで、\*\*文字もアイコン配置もすべて左右逆（鏡写し）\*\*になること。<br>→ 特に「戻るボタン」の向きが逆になっているか確認。 |
| **TC-F03-02** | **長文耐性** | **P2** | 設定で「German（ドイツ語）」を選ぶ。<br>→ 長い単語がボタンからはみ出さず、縮小表示または改行されていること。 |
| **TC-F03-03** | **日付フォーマット** | **P2** | 日本語なら「12月10日」、英語なら「Dec 10」と表示されていること。 |

### F-04: 課金・Proプラン (Purchase)

| テストID | テスト項目名 | 優先度 | 手順と確認内容 |
| :--- | :--- | :--- | :--- |
| **TC-F04-01** | **購入フロー** | **P1** | (Sandbox) 年額プランを購入する。<br>→ OSの購入画面が出て、承認後、お祝いアニメーションが出てPro機能が解放されること。 |
| **TC-F04-02** | **リストア** | **P1** | アプリを再インストールし、「Restore」ボタンを押す。<br>→ 以前の購入状態が復活すること（これができないと審査に落ちます）。 |
| **TC-F04-03** | **オフライン購入** | **P2** | 機内モードで購入ボタンを押す。<br>→ アプリが落ちず、「インターネット接続が必要です」等のエラーメッセージが出ること。 |

### F-06 & F-08: 日付更新とウィジェット

| テストID | テスト項目名 | 優先度 | 手順と確認内容 |
| :--- | :--- | :--- | :--- |
| **TC-F06-01** | **日付またぎ** | **P1** | 23:59にアプリを開いたまま放置し、0:00を過ぎてから操作する。<br>→ 画面の日付が変わり、ボタンがリセットされること。 |
| **TC-F08-01** | **ウィジェット起動** | **P1** | ホーム画面のウィジェットをタップする。<br>→ アプリが起動し、**自動的に記録完了アニメーションが走る**こと。 |

-----

## 5\. 非機能テスト（品質の底上げ）

### 5.1 パフォーマンスとバッテリー

| テストID | テスト項目名 | 合格基準 |
| :--- | :--- | :--- |
| **TC-NF-01** | **コールドスタート** | アイコンタップから操作可能になるまで **2秒以内**。 |
| **TC-NF-02** | **メモリリーク** | 10分間連続で操作しても、スマホが熱くなったり動作がカクついたりしないこと。 |

### 5.2 システム設定との競合

| テストID | テスト項目名 | 合格基準 |
| :--- | :--- | :--- |
| **TC-NF-03** | **システムハプティクスOFF** | (iOS/Android設定で振動をOFFにする) <br>→ アプリ内設定がONでも、端末設定に従って**振動しない**こと。（ユーザー設定の尊重） |
| **TC-NF-04** | **ダークモード設定** | 端末がライトモードでも、このアプリは\*\*常にダークモード（黒背景）\*\*で表示されること。（世界観の維持） |

-----

## 6\. リリース判定基準（Go/No-Go）

以下の条件を**1つでも満たさない場合、リリースは延期**します。妥協はしません。

1.  **[自動] CIチェック**: `pnpm lint`, `test`, `test:e2e` が全て `Pass`。
2.  **[手動] P1バグゼロ**: 進行不能、課金不可、データ消失などの重大バグが0件。
3.  **[感触] 実機確認**: 開発者自身が実機で触って「気持ちいい」と断言できること。
4.  **[法務] 規約リンク**: プライバシーポリシーと利用規約のリンクが切れていないこと。
5.  **[ストア] スクショ**: 19言語それぞれの言語設定でのスクリーンショットが用意されていること（英語のスクショを使い回さない）。

-----

## 7\. 開発者へのメッセージ

テストは「あら探し」ではありません。
**「このアプリは最高だ」と自信を持つための儀式**です。

特に **TC-F01-01（快感の即時性）** と **TC-F01-02（音楽との共存）** は、このアプリの魂です。ここだけは絶対に譲らないでください。

全ての項目にチェックがついた時、あなたのアプリは世界へ羽ばたきます。