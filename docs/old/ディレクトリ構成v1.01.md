# ディレクトリ構成.md
App Factory 標準ディレクトリ・ファイル責務一覧（SOW）

このファイルは、`~/04_app-factory` でアプリを量産する際の
**「工場の整理整頓ルール（設計図）」** です。

- **目的**:
  - 「どのファイルをどこに置くか」で迷う時間をゼロにする
  - 誰が見ても、どこに何のプログラムがあるか一発で分かるようにする
  - 1つのアプリだけでなく、次のアプリを作る際も同じ構成でスタートできるようにする

---

## 0. 基本ルール（SOW: Statement of Work）

各フォルダ・ファイルには「仕事（責務）」があります。
「何をしていい場所か」「何をしてはいけない場所か」を定義します。

### 用語解説（小中学生向け）
- **責務（せきむ）**: そのファイルが担当する「お仕事」。
- **Input（入力）**: そのお仕事をするために必要な材料。
- **Output（出力）**: そのお仕事の結果として生まれるもの。

---

## 1. ルート直下の構成（工場の敷地）

アプリの根っこにある、最も重要な設定ファイルたちです。

### 1-1. `package.json`
- **責務**: 工場の「部品リスト」兼「司令室」。
- **Input**: 開発者が使いたいライブラリ（部品）の名前。
- **Output**: アプリを動かすために必要な部品のインストール指示。
- **解説**: `scripts` 欄に書かれたコマンド（`dev`, `test` など）は、工場のスイッチです。

### 1-2. `app.json` / `app.config.ts`
- **責務**: アプリの「名札」と「外見の設定」。
- **内容**: アプリ名、アイコン画像の場所、バージョン番号、Android/iOSごとの設定。
- **ルール**: **CNG (Continuous Native Generation)** を採用しているため、ここで設定を変えたら `npx expo prebuild` で反映させます。

### 1-3. `tamagui.config.ts`
- **責務**: アプリ全体の「デザインルールブック」。
- **内容**: 使える色（カラーパレット）、フォント、文字サイズ、余白のルール。
- **やってはいけないこと**: ここに具体的な画面のコードを書くこと。あくまで「ルール」だけを書く。

### 1-4. `babel.config.js` / `metro.config.js` / `tsconfig.json`
- **責務**: 「翻訳機」の設定。
- **解説**: 人間が書いたTypeScriptを、スマホが理解できるJavaScriptに変換するための細かいルール設定です。基本はいじりません。

---

## 2. `app/` フォルダ（玄関・廊下）

**Expo Router** の仕組みを使う場所です。
ここのファイル構成が、そのままアプリの「画面遷移（URL）」になります。

### 2-1. `app/_layout.tsx`
- **責務**: アプリ全体の「枠組み（レイアウト）」を決める。
- **内容**: ナビゲーションバー（ヘッダー）やタブバーの表示設定、プロバイダー（設定の読み込み）を行います。

### 2-2. `app/index.tsx`
- **責務**: アプリを起動して最初に表示される「表紙」。
- **ルール**: ここには複雑なロジックを書かず、`src/features/` から機能を呼び出して表示するだけにします。

### 2-3. `app/[...screen].tsx` (各画面)
- **責務**: それぞれのページの「入れ物」。
- **例**: `app/settings/index.tsx` は設定画面の入れ物。
- **ルール**: 画面遷移のパラメータ（IDなど）を受け取り、それを `src/features` のコンポーネントに渡す「仲介役」に徹します。

---

## 3. `src/` フォルダ（工場の作業場）

プログラムの本体は全てここに置きます。

### 3-1. `src/features/` （機能ごとの部屋）
**最も重要なフォルダです。** アプリの機能を「機能単位」でまとめます。

* **構造例**:
    ```text
    src/features/
      habit/          (機能)
        components/   (この機能だけの部品)
        hooks/        (この機能だけのロジック)
        types.ts      (型定義)
      settings/       (設定機能)
    ```
* **責務**: 特定の機能（習慣管理、課金、設定など）に関する全てを完結させる。
* **メリット**: 「習慣機能を消したい」と思ったら、`habit` フォルダを消すだけで済むようになります。

### 3-2. `src/ui/` （共通のレゴブロック）
アプリ全体で使う、小さくて単純な部品を置きます。

* **責務**: デザインが統一されたボタン、カード、入力フォームなどを提供する。
* **ルール**: ここに「ビジネスロジック（データの保存など）」を書いてはいけません。見た目に関するコードだけを書きます。
* **例**: `MyButton.tsx` (ただの青いボタン), `Card.tsx` (白い枠)

### 3-3. `src/stores/` （ホワイトボード）
アプリ全体で共有したいデータ（状態）を管理します（Zustandを使用）。

* **責務**: データの保持と書き換え。
* **例**:
    * `habitStore.ts`: 習慣データのリストを一時的に持つ。
    * `uiStore.ts`: ダークモードかどうかの設定を持つ。

### 3-4. `src/db/` （倉庫）
スマホ本体に保存するデータベース（SQLite）の管理場所です。

* **責務**: データの永続化（アプリを閉じても消えないようにする）。
* **ファイル**:
    * `database.ts`: データベースへの接続、初期化。
    * `schema.ts`: データの形（テーブル定義）を決める場所。
    * `queries.ts`: データを出し入れする命令文（SQL）をまとめる場所。

### 3-5. `src/core/` （インフラ・設備）
アプリの機能には依存しない、裏方の仕組みを置きます。

* **責務**: ログ出力、多言語化（翻訳）、通知機能、振動（Haptics）などのユーティリティ。
* **例**: `i18n.ts` (翻訳機能), `logger.ts` (エラー記録)

---

## 4. `assets/` フォルダ（素材置き場）

* **責務**: 画像、アイコン、フォント、効果音ファイルなどを置く。
* **ルール**: プログラムコードは置きません。

---

## 5. `maestro/` フォルダ（検品ロボット）

**Maestro** というツールを使った自動テストの指示書を置きます。

* **責務**: アプリが壊れていないか、自動で操作してチェックするシナリオを置く。
* **例**: `flows/smoke.yml`（起動して、ボタンを押して、設定が開くかを確認する一連の流れ）。

---

## 6. `.github/` フォルダ（自動化ライン）

GitHub Actions の設定ファイルを置きます。

* **責務**: クラウド上（GitHub）で行う自動作業の指示書。
* **例**:
    * `workflows/build-android.yml`: Androidアプリを自動で作る。

---

## 7. `scripts/` フォルダ（便利ツール）

開発者が楽をするための小さなプログラムを置きます。

* **責務**: コマンド一発で複雑な作業を片付ける。
* **例**:
    * `reset-project.js`: アプリを初期状態に戻す。
    * `generate-icons.js`: 1枚の画像から全サイズのアイコンを作る。

---

## 8. `docs/` フォルダ（説明書）

このファイルを含む、設計図やメモを置く場所です。

* **責務**: 未来の自分やチームメンバーへの伝言。