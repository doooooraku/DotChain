# 2_機能設計書（DotChain v1.0）

---

## 1. 本書の目的

本書「2_機能設計書.md」は、DotChain v1.0 の**機能ごとの振る舞い（ロジック / フロー）**を定義するドキュメントです。

- 0_プロダクト戦略.md … プロダクトの目的・ターゲット・KPI
- 1_基本仕様書.md … 機能一覧（F-01〜F-07）の概要
- 1.5_UI_画面設計書.md … 画面構成・UIコンポーネント
- **2_機能設計書.md … 各機能のフロー・条件分岐・状態変化を定義**
- 3_詳細設計書.md … コンポーネント構造・ストア構造・型定義など

という関係になっています。

このファイルだけで、

- 各機能（F-01〜F-07）が **どのような手順で動くか**
- Free / Pro やエラー時に **どう分岐するか**
- どの画面（S-01〜S-04）から **どの機能が呼ばれ、何を更新するか**

が分かる状態を目標とします。

---

## 2. 前提・対象範囲

### 2-1. 対象バージョン

- アプリバージョン：DotChain v1.0.0
- 対応OS：
  - iOS：15 以上
  - Android：8.0（API 26）以上

### 2-2. 参照ドキュメント

- 0_プロダクト戦略.md
- 1_基本仕様書.md
- 1.5_UI_画面設計書.md
- 4_実装ルール.md（コーディング規約・ディレクトリ構成 等）
- 5_テスト仕様書.md（テスト観点）
- 6_セキュリティ・法務・ライセンス.md

### 2-3. 非対象機能（v1.0 では実装しない）

旧仕様に存在していた以下の機能は、DotChain v1.0 では「完全に対象外」とします。

- ホームウィジェット / ウィジェット連携
- アプリアイコン変更（Pro限定アイコン）
- RTLレイアウト（右→左言語）対応
- OSSライセンス専用画面（Open Source Licenses 画面）

※将来的に復活させる場合は、0〜2系の仕様書を改版すること。

---

## 3. 用語とモデル（機能設計上の前提）

### 3-1. 基本モデル

本書で扱う主な「データの塊（モデル）」を簡易に定義します。
詳細な型・永続化形式は 3_詳細設計書 で扱います。

#### (1) Habit（習慣）

- id：一意なID（例：文字列UUID）
- name：習慣名（例：「筋トレ」「英語」）
- iconKey：アイコン識別子（"dumbbell" など）
- colorKey：カラー識別子（"green" など）
- createdAt：作成日時
- updatedAt：更新日時

#### (2) HabitLog（習慣記録）

- habitId：対象習慣のID
- date：日付（端末ローカルタイムゾーンでの「YYYY-MM-DD」）
- status：`"done"` or `"not_done"`（v1.0では2値のみ）
- updatedAt：最終更新日時

> ポイント：
> - 1日1習慣あたり、レコードは **最大1件**。
> - 何度タップしても、その日の最終状態だけを保存する。

#### (3) Settings（設定）

- language：使用言語（18言語のコード）
- theme：テーマ（"dark" | "neonPink" | "cyberBlue"）
- soundEnabled：効果音ON/OFF
- hapticsEnabled：振動ON/OFF
- electricFlow：ヒートマップ上のチェーンライン電流アニメON/OFF
- heatmapDays：ヒートマップ表示日数（30/60/180/365 など）

補足：
- electricFlow はホーム画面の HeatmapChain（チェーンライン）上を流れる電流風アニメーションのみを制御する。HabitButton のグロー演出はタップフィードバックとして常時有効で、electricFlow の対象外。

#### (4) ProState（課金状態）

- isPro：Proプランかどうか（true/false）
- lastCheckAt：最後に RevenueCat と同期した日時
- anonUserId：RevenueCatが管理する匿名ユーザーID

### 3-2. 日付・タイムゾーンの考え方

- すべての「日付」は **端末ローカルのカレンダー日付** を正とする。
- 1日の境界は「端末ローカルの 0:00〜23:59」で定義。
- `date` は文字列 `YYYY-MM-DD` で扱う（例："2025-11-30"）。

---

## 4. 全体機能マップ

### 4-1. 機能一覧（F-01〜F-07）と画面の関係

| 機能ID | 機能名                                   | 主な呼び出し元画面 |
|--------|------------------------------------------|--------------------|
| F-01   | 習慣実行の記録（ワンタップ & チェーン） | S-01 ホーム       |
| F-02   | 習慣の追加・編集・削除                   | S-01 ホーム / S-03|
| F-03   | 設定変更（テーマ・言語・演出など）       | S-02 設定         |
| F-04   | Proプラン購入 / 課金復元                 | S-04 Pro / S-02   |
| F-05   | 多言語切替（18言語）                     | S-02 設定         |
| F-06   | Proプラン効果の反映（制限解除）          | S-01 / S-02 / S-03|
| F-07   | バナー広告表示（AdMob）                  | S-01 ホーム       |

---

## 5. 機能別詳細設計

以下、各機能ごとに「目的 / 事前条件 / 事後条件 / メインフロー / 例外フロー / Free/Pro 差分」を定義します。

---

### 5-1. F-01：習慣実行の記録（ワンタップ & チェーン）

#### 5-1-1. 機能の目的

- ユーザーが **「今日やったかどうか」** を素早く記録できるようにする。
- 記録結果をカレンダー上のドット（チェーン）として即時反映する。

#### 5-1-2. アクター

- ユーザー

#### 5-1-3. 事前条件

- アプリが起動し、S-01 ホーム画面が表示されていること。
- HabitStore に1件以上の習慣が登録されていること（ゼロ件の場合は「習慣を追加」カードが表示される）。

#### 5-1-4. 事後条件

- HabitLog に当該日付・当該習慣の `status` が保存される。
- カレンダーの表示が更新され、
  - 達成日のマスが `ACCENT` 色で光る
  - 連続日数（チェーン）が再計算される

> 連続日数（チェーン）の定義
>
> - 「今日」を起点に、1日ずつ過去へさかのぼって判定する。
> - その日付に **1件でも習慣の達成ログがあれば「続いている」** とみなしてカウントを+1。
> - どこか1日でも「達成ログが0件」の日が出た時点で連続は途切れる。
> - さかのぼる範囲は、ログに現れる最も古い日付まで（365日などの上限は設けない）。

#### 5-1-5. メインフロー（達成にする場合）

1. ユーザーが S-01 の習慣リストから、対象習慣行のトグルボタンをタップする。
2. アプリは現在日付（ローカル）を取得し、`dateKey = YYYY-MM-DD` を算出する。
3. HabitLog から `habitId + dateKey` のレコードを検索する。
4. レコードが**存在しない**場合：
   - `status = "done"` の新規レコードを作成し、保存する。
5. レコードが**存在する**場合：
   - `status` を `"done"` に上書きし、`updatedAt` を現在時刻に更新する。
6. カレンダー表示用の状態を再計算し、UIを更新する。
7. 視覚的フィードバック（ボタンアニメーション・エフェクト・サウンド・振動）を再生する。

#### 5-1-6. メインフロー（未達成に戻す場合）

1. ユーザーが、既に達成状態になっているトグルボタンを再度タップする。
2. ステップ2〜3は同じ。
3. レコードが存在する場合：
   - `status = "not_done"` に変更する。
   - 必要に応じて、`not_done` レコードを物理削除するかどうかは詳細設計で決定（v1.0ではステータス保持で問題ない）。
4. カレンダー表示を更新する（該当日を非達成色に戻す）。

#### 5-1-7. 例外フロー

- DB書き込みエラー：
  - UI上のトグル状態を元に戻す。
  - トーストで「保存に失敗しました」メッセージを表示。

- 日付跨ぎ：
  - バックグラウンドから復帰したときに日付が変わっている場合は、
    - まず `todayKey` を更新し、
    - ホーム画面の表示を新しい日付に切り替えたうえでF-01処理を行う。

#### 5-1-8. Free / Pro 差分

- F-01自体の仕様に差分はない（どちらも同じように記録できる）。
- 差分は **「管理できる習慣数」** にのみ影響（F-02 / F-06 参照）。

#### 5-1-9. ホーム上部に表示する2つの統計

- **連続日数（daysStreak）**
  - 上記「連続日数の定義」に従って算出した“現在の連続達成日数”。
  - 例: `🔥 14` は「過去14日間、毎日1件以上達成している」ことを示す。
- **All Done 日数（allDoneDays）**
  - その日までに「存在していた」習慣を **全て達成** できた日を通算でカウント。
  - 判定手順:
    1. 習慣ごとに作成日を日付キーへ変換し、当該日付以前に作成された習慣だけを「その日の対象」とする。
    2. 対象となる全習慣について、その日に達成ログがあるか確認。
    3. 1件でも欠けていればカウントしない。すべて揃っていればその日を「All Done」として+1。

---

### 5-2. F-02：習慣の追加・編集・削除

#### 5-2-1. 機能の目的

- ユーザーが自分の生活・目的に合わせた習慣を定義・変更・削除できるようにする。

#### 5-2-2. アクター

- ユーザー

#### 5-2-3. 事前条件

- S-01 ホームまたは S-03 習慣編集画面が表示されている。

#### 5-2-4. Free / Pro の件数制限（定量条件）

- Free版：Habit件数は **最大3件**。
- Pro版：アプリ側で件数上限は設けない。

> 判定方法：`isPro` フラグ（F-06）を参照し、HabitStore.habits.length を見て分岐する。

#### 5-2-5. 新規追加フロー（Free版で3件未満の場合）

1. ユーザーが S-01 の FAB「＋」をタップし、S-03へ。
2. ユーザーが以下を入力 / 選択：
   - 習慣名
   - アイコン
   - カラー
3. ユーザーが「保存」をタップ。
4. アプリは以下を確認：
   - `isPro == false`
   - 現在の Habit 件数 `< 3`
5. 条件を満たしていれば、新規 Habit レコードを作成・保存。
6. S-01に戻り、新しい習慣行をリストに表示。

#### 5-2-6. 新規追加フロー（Free版で3件に到達済みの場合）

1. ステップ1〜3までは同じ。
2. 保存ボタンタップ後、アプリは以下を判定：
   - `isPro == false`
   - 現在の Habit 件数 `>= 3`
3. 上記の場合：
   - Habit の保存処理は **行わない**。
   - 以下の内容の **Alertダイアログ** を表示：
     - タイトル：「無料版の上限に達しました」
     - 本文：「無料版では習慣は3つまでです。Proにアップグレードすると無制限に追加できます。」
     - ボタン：
       - キャンセル（閉じるだけ）
       - Proを確認する（S-04 Pro画面へ遷移）

4. ユーザーが「Proを確認する」を押した場合：
   - S-04 Pro へ遷移。

> 注意：
> - ホーム画面側に「あと◯個で上限です」などの常時テキストは**表示しない**。
> - 上限は「4件目の保存時に初めて」ユーザーが知る挙動とする。

#### 5-2-7. 新規追加フロー（Pro版）

1. `isPro == true` の場合、Habit件数のチェックは行わない。
2. 保存ボタン押下で Habitを作成し、S-01へ戻る。

#### 5-2-8. 編集フロー

1. S-01 の習慣行の「編集アイコン」をタップ。
2. 対応する Habit を取得し、S-03 に初期値としてセット。
3. ユーザーが名前・アイコン・カラーを変更。
4. 「保存」をタップ。
5. Habit レコードを更新し、S-01 に戻る。

#### 5-2-9. 削除フロー

1. S-03 編集モードで「削除」ボタンをタップ。
2. 確認ダイアログを表示：
   - タイトル：「習慣を削除しますか？」
   - 本文：「この習慣と、これまでの記録がすべて削除されます。」
3. ユーザーが「削除」を選択した場合：
   - Habit レコードを削除。
   - 対応する HabitLog（habitIdが一致するもの）を全て削除。
   - S-01 へ戻る。

---

### 5-3. F-03：設定変更（テーマ・言語・演出など）

#### 5-3-1. 機能の目的

- ユーザーがアプリの見た目・挙動を自分の好みに合わせてカスタマイズできるようにする。

#### 5-3-2. アクター

- ユーザー

#### 5-3-3. 対象項目

- 言語（F-05と連動）
- テーマ（Dark / Neon Pink / Cyber Blue）
- 効果音 ON/OFF
- 振動 ON/OFF
- エフェクト ON/OFF
- ヒートマップ表示範囲（日数）
- 購入を復元（F-04と連動）

#### 5-3-4. 共通フロー

1. ユーザーが S-02 設定画面を開く。
2. ユーザーが各項目を操作する（トグル / セレクト）。
3. アプリは Settings モデルを更新し、即時にUIへ反映する。
4. Settings は永続化（ローカル保存）され、次回起動時にも復元される。

#### 5-3-5. テーマ変更フロー

- Free版：
  1. ユーザーが「Dark」以外のテーマをタップ。
  2. `isPro == false` の場合：
     - S-04 Pro 画面へ遷移（テーマは変わらない）。

- Pro版：
  1. ユーザーが任意のテーマをタップ。
  2. Settings.theme を更新。
  3. アプリ全体のテーマが即時に切替わる。

#### 5-3-6. ヒートマップ表示範囲

1. ユーザーが「ヒートマップ表示期間」行をタップ。
2. 選択ダイアログを表示（30 / 60 / 180 / 365 日）。
3. ユーザーが1つ選択。
4. Settings.heatmapDays を更新。
5. ホーム画面のカレンダーは、次回表示時から新しい範囲でデータを読み込む。

---

### 5-4. F-04：Proプラン購入 / 課金復元

#### 5-4-1. 機能の目的

- ユーザーが Proプランを月額 or 年額で購入できるようにする。
- 機種変更や再インストール後に、「購入を復元」できるようにする。

#### 5-4-2. 使用サービス

- RevenueCat（サブスクリプション管理）

#### 5-4-3. 購入フロー（正常系）

1. ユーザーが S-04 Pro画面を開く。
2. 月額／年額のいずれかのプランカードをタップ。
3. アプリは RevenueCat SDK 経由で、該当プランの購入処理を開始。
4. OS標準の課金ダイアログ（App Store / Google Play）が表示される。
5. ユーザーが購入を承認し、決済が成功する。
6. RevenueCat から「有効なサブスクリプション」として応答が返る。
7. アプリは以下を行う：
   - `isPro = true` に設定（メモリ上の ProState を更新）。
   - ProState（isPro, anonUserId, lastCheckAt）を SecureStore へ保存。
   - Free制限解除（F-06）を反映：
     - 習慣数上限解除
     - バナー広告非表示
     - テーマロック解除
   - 成功Alertを表示：
     - タイトル：「Proプランが有効になりました」
     - 本文：「習慣数の上限がなくなり、広告も非表示になります。」

#### 5-4-4. 購入フロー（失敗系）

失敗パターンの例：

- ユーザーキャンセル
- ネットワークエラー
- ストアエラー

いずれの場合も：

1. `isPro` は変更しない（falseのまま）。
2. Alert ではなく **Toast** でエラーを表示：
   - 例：「購入に失敗しました。時間をおいて再度お試しください。」
   - 可能ならエラーコードを解釈し、文言を分岐（詳細は実装側で）。

#### 5-4-5. アプリ起動時の Pro 状態同期

1. アプリ起動時（スプラッシュ後）、SecureStoreから ProState を読み込む。
2. `isPro` が true であれば、そのまま Pro状態としてUIを構成。
3. 一定間隔（例：起動時 + 24時間ごと）で RevenueCat に問い合わせ、
   - 購読が有効 → `isPro = true` のまま
   - 購読が失効 → `isPro = false` に更新（広告を再表示・テーマをDarkに戻す など）

> 詳細な同期タイミング・実装方法は 3_詳細設計書 で定義。

#### 5-4-6. 購入を復元（Restore）

1. ユーザーが S-02 設定の「購入を復元」行をタップ。
2. RevenueCat に対して購読情報の問い合わせを行う。
3. 結果に応じて分岐：

   - 有効な購読が見つかった場合：
     - `isPro = true` をセット。
     - SecureStore に保存。
     - 成功Alert表示：「購入を復元しました」。

   - 有効な購読が見つからない場合：
     - `isPro` は変更しない。
     - Toast表示：「復元できる購入は見つかりませんでした。」

   - ネットワーク / その他エラー：
     - `isPro` は変更しない。
     - Toast表示：「購入の復元に失敗しました。」

#### 5-4-7. 表示文言について

- Paywall / Pro画面での文言は、「将来実装予定」ではなく **現時点の挙動のみ** を説明する。
  - 例：
    - 「近日追加予定」「Coming soon」などは使用しない。
    - 実装済みの機能のみを表に記載する。

---

### 5-5. F-05：多言語切替（18言語対応）

#### 5-5-1. 機能の目的

- ユーザーが、自分の理解しやすい言語でDotChainを利用できるようにする。
- 対応言語数を増やすことで、世界中のユーザーに展開できるようにする。

#### 5-5-2. 対応言語（18言語）

アラビア語を除外し、以下の18言語に対応する：

- en：英語
- ja：日本語
- fr：フランス語
- es：スペイン語
- de：ドイツ語
- it：イタリア語
- pt：ポルトガル語
- ru：ロシア語
- zhHans：中国語（簡体字）
- zhHant：中国語（繁体字）
- ko：韓国語
- th：タイ語
- id：インドネシア語
- vi：ベトナム語
- hi：ヒンディー語
- tr：トルコ語
- pl：ポーランド語
- sv：スウェーデン語

#### 5-5-3. 機能フロー

1. ユーザーが S-02 設定画面を開く。
2. 「Language」セクション内の言語リストから1つをタップ。
3. アプリは Settings.language を更新し、i18nライブラリへ反映。
4. 現在表示中の画面のテキストを即時更新（アプリ再起動は不要）。

#### 5-5-4. 技術的前提（機能レベル）

- テキストはすべて i18n キー（例：`home.title`, `settings.language.title`）で管理。
- UIコンポーネント内でハードコード文字列は使用しない。
- RTL対応は行わない（レイアウトはLTR前提）。

---

### 5-6. F-06：Proプラン効果の反映（制限解除）

#### 5-6-1. 機能の目的

- `isPro` 状態に応じて、アプリ全体の制限を自動的に切り替える。
- 「Proになった瞬間」に UX が変わることを保証する。

#### 5-6-2. 制限項目一覧

| 項目           | Free                                      | Pro                              |
|----------------|-------------------------------------------|-----------------------------------|
| 登録できる習慣 | 最大3件                                   | 制限なし                         |
| バナー広告     | S-01下部に常時表示                       | 一切表示しない                   |
| テーマ         | Darkのみ選択可（他はロック → Pro誘導） | Dark / Neon Pink / Cyber Blue 可 |

#### 5-6-3. 起動時処理

1. アプリ起動時に SecureStore から ProState を読み込み、`isPro` を決定。
2. `isPro` に応じて以下を行う：
   - Freeの場合：
     - S-01 にバナー広告コンポーネントをマウント。
     - S-02 テーマ設定で Neon / CyberBlue をロック表示。
   - Proの場合：
     - 広告コンポーネントはマウントしない。
     - テーマ全開放。

#### 5-6-4. ランタイム切替

- ユーザーが Pro購入に成功した場合（F-04）：
  1. `isPro` を true に更新。
  2. 以下を即時反映：
     - バナー広告コンポーネントをアンマウント。
     - テーマロック解除（設定画面を開き直すと全テーマ選択可能）。
     - S-01 のヘッダから王冠（Pro誘導）を消す、または「PRO」バッジに切替。

- ユーザーの購読が失効した場合（RevenueCat同期で判明）：
  1. `isPro` を false に更新。
  2. 以下を即時反映：
     - S-01 の広告を表示（再マウント）。
     - テーマは Dark に強制変更（Neon/CyberBlueを使用していた場合）。
     - 設定画面の表示も Free 状態に戻す。

> 失効時のユーザー告知は、将来のUX調整により Alert/Toast を追加検討可能だが、v1.0では必須要件としない（5_テスト仕様書でテスト有無を明示）。

---

### 5-7. F-07：バナー広告表示（AdMob）

#### 5-7-1. 機能の目的

- Freeユーザーからの収益を得つつ、習慣記録の邪魔になりにくい形で広告を表示する。

#### 5-7-2. アクター

- ユーザー
- AdMob 広告ネットワーク

#### 5-7-3. 表示条件

- `isPro == false` の場合のみ S-01 下部に表示。
- `isPro == true` の場合は広告コンポーネントを一切マウントしない。

#### 5-7-4. メインフロー

1. S-01 ホーム画面のマウント時に、`isPro` を参照。
2. Free の場合：
   - AdMob バナーコンポーネントをレンダリング。
   - SDKが自動的に広告を取得・表示。
3. Pro の場合：
   - 広告コンポーネントはレンダリングしない。

#### 5-7-5. 例外フロー

- 広告取得失敗：
  - エラー内容はコンソール等でログ出力。
  - ユーザーには通知せず、「何もない」状態とする。

---

## 6. ユースケース別フローまとめ

0_プロダクト戦略 / 1_基本仕様で定義した代表ユースケースを、機能IDと紐づけて整理します。

### UC-01：毎日の習慣を記録する

- 関連機能：F-01, F-06, F-07
- 主な流れ：
  1. ユーザーがアプリを起動（S-01）。
  2. ProStateに応じて広告の有無などを反映（F-06, F-07）。
  3. ユーザーが習慣トグルをタップ（F-01）。
  4. HabitLog を更新し、カレンダーに反映。

### UC-02：新しい習慣を追加する

- 関連機能：F-02, F-06
- 主な流れ：
  1. S-01 の FAB をタップ → S-03 へ。
  2. ユーザーが名称・アイコン・カラーを設定。
  3. 保存ボタンで、Free/Pro・件数に応じて分岐（F-02）。

### UC-03：Proプランを購入する

- 関連機能：F-04, F-06, F-07
- 主な流れ：
  1. S-02 または S-01 から S-04 Pro へ。
  2. プランカードをタップし、RevenueCatで購入（F-04）。
  3. 成功時に isPro 更新 → 広告非表示・制限解除（F-06, F-07）。

### UC-04：言語を切り替える

- 関連機能：F-03, F-05
- 主な流れ：
  1. S-02 設定 → Language セクション。
  2. 任意の言語をタップ。
  3. Settings.language 更新 → UI 文言即時切替。

---

## 7. 開発で使う代表的なコマンド（おさらい）

機能実装・動作確認の際によく使うコマンドと、その意味を簡単にまとめます。

> 詳細な開発手順・環境構築は 4_実装ルール.md 側で詳述します。

### 7-1. ライブラリのインストール

```bash
pnpm install
```

- **pnpm（ピーエヌピーエム）**：Node.js のパッケージ（ライブラリ）を管理するツール。
- `pnpm install`：`package.json` に書かれたすべての依存ライブラリをダウンロードして `node_modules` に配置するコマンド。

### 7-2. 開発サーバの起動

```bash
pnpm expo start
```

- **expo（エキスポ）**：React Native アプリを簡単に動かすためのツール群。
- `expo start`：開発用のローカルサーバを起動し、スマホ（Expo Go）やエミュレータからアプリを実行できるようにするコマンド。

### 7-3. 実機 / エミュレータでのビルド

```bash
pnpm expo run:ios
pnpm expo run:android
```

- `expo run:ios`：iOS シミュレータ / 実機でアプリをビルド・起動。
- `expo run:android`：Android エミュレータ / 実機でアプリをビルド・起動。

### 7-4. テスト実行

```bash
pnpm test
```

- アプリのロジックやコンポーネントに対するテストを自動実行するコマンド。
- F-01〜F-07 の重要ロジックには、可能な限りユニットテストを用意することを推奨。

### 7-5. E2Eテスト（Maestro の例）

```bash
pnpm maestro test
```

- **Maestro**：モバイルアプリの画面操作を自動化し、実際のユーザー操作に近いテストを行うツール。
- 例：
  - アプリ起動 → 習慣追加 → 今日の記録 → Pro購入画面遷移 … など、実際の画面遷移を自動でなぞる。

---

## 8. 参考アプリ・資料

機能・フロー設計時に参考にしたアプリや資料。

- Loop Habit Tracker  
  https://loophabits.org/
- Streaks  
  https://streaksapp.com/
- Habitify  
  https://habitify.me/
- Productive  
  https://productiveapp.io/

これらは、

- シンプルな習慣記録フロー
- ストリークの見せ方
- Free / Pro の機能差

などの観点で参考としつつ、DotChain 独自の「ネオンサイバーな世界観」「Freeでも本気で使える」「18言語対応」という方針に沿って設計しています。

---

本 2_機能設計書.md をもとに、3_詳細設計書でコンポーネントレベルの設計（Props・Store構造・関数シグネチャ）を具体化していきます。

---

### F-08：レビュー依頼フロー（7日連続達成）

1. ホーム（S-01）で習慣ボタンをタップし、当日のステータスが「未達成 → 達成」に変化。
2. `habitStore` の状態から連続達成日数（streak）を算出。
3. 次の条件をすべて満たす場合のみレビュー依頼を実行する。  
   - streak === 7  
   - `settingsStore.hasRequestedReview === false`
4. 0.8 秒遅延で Alert を表示（文言は i18n キー `streak7Title`, `streak7Message`, `ok`）。
5. OK タップ時に `expo-store-review` の `isAvailableAsync` → `hasAction` → `requestReview` を順に実行。
6. 成否にかかわらず `hasRequestedReview` を true にセットし、同一端末では再度依頼しない。
7. Free / Pro の挙動差分なし。
