
# 6_セキュリティ・法務・ライセンス.md（DotChain）

## 1. はじめに

### 1.1 本書の目的

このドキュメントは、アプリ **「DotChain（ドットチェーン）」** を安全かつ合法的に運営するための「守りの設計図」です。

- **セキュリティ**: ユーザーの「習慣データ」や「課金情報」をどう守るか。
- **法務**: 世界中の法律（GDPRなど）や、Apple/Googleの厳しいルールをどうクリアするか。
- **ライセンス**: 使っている道具（ライブラリ）や素材の権利関係はどうなっているか。

これらを明確にすることで、**「ストア審査でのリジェクト（拒否）」**を防ぎ、ユーザーからの信頼を獲得します。

### 1.2 想定読者

- **開発者（あなた）**: 実装時に「このデータはどこに保存すべき？」と迷った時の判断基準にします。
- **法務担当（未来のあなた）**: プライバシーポリシーを書く時のネタ帳にします。

---

## 2. セキュリティ方針（Security）

### 2.1 基本ポリシー

DotChainは**「オフラインファースト」**かつ**「アカウントレス」**です。
これが最大のセキュリティ対策になります。

1.  **持たないセキュリティ**: メールアドレス、パスワード、電話番号などの個人情報は**一切取得しません**。
2.  **端末内完結**: 習慣データはすべてユーザーのスマホの中（SQLite）に保存し、外部サーバーには送りません。
3.  **最小権限**: カメラ、マイク、位置情報などの「危険な権限」は要求しません。

### 2.2 データの種類と保存場所（Data Inventory）

この表は、Apple/Googleのストアで「プライバシー設定（App Privacy / Data Safety）」を入力する時にそのまま使います。

| ID | データの種類 | 具体例 | 必須/任意 | 保存場所 | 第三者共有 | 利用目的 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **D-01** | **習慣データ** | 習慣の名前、アイコン、記録ログ | 必須 | **SQLite** (端末内) | なし | アプリ機能 |
| **D-02** | **設定情報** | 言語、テーマ、通知設定 | 必須 | **AsyncStorage** (端末内) | なし | アプリ設定 |
| **D-03** | **課金状態** | Proプラン有効期限、匿名ユーザーID | 必須 | **RevenueCat** / SecureStore | **あり** (RevenueCat) | 課金管理 |
| **D-04** | **広告ID** | 広告識別子 (IDFA/GAID) | 任意 | **AdMob SDK** | **あり** (Google) | 広告配信 |


> **用語メモ**:
> * **IDFA/GAID**: ネット広告が「あなたに興味がありそうな広告」を出すために使う、スマホごとの名札のようなもの。
> * **RevenueCat**: 課金システムを管理する外部サービス。ここでは「匿名ID（誰かわからないID）」だけを使って管理します。

### 2.3 実装レベルのセキュリティ対策

#### 2.3.1 データ保存のルール（Data at Rest）

1.  **SQLite (expo-sqlite)**
    * 習慣の記録（「今日筋トレした」など）はここに保存。
    * **SQLインジェクション対策**: 必ず「プレースホルダー（`?`）」を使う書き方をする。
        * OK: `db.runAsync('INSERT INTO habits (name) VALUES (?)', [name])`
        * NG: `db.runAsync('INSERT INTO habits (name) VALUES ("' + name + '")')`
2.  **SecureStore (expo-secure-store)**
    * 「外から見られたら困るデータ」専用の金庫。
    * DotChainでは、**RevenueCatの匿名ユーザーID**や、復元用のトークンのみを保存する。
    * 普通の設定（「音を鳴らすかどうか」など）は入れない。

#### 2.3.2 通信のルール（Data in Transit）

1.  **HTTPS必須**: 広告や課金の通信はすべて暗号化される（SDKが自動でやってくれるので、開発者が意識しなくてもOK）。
2.  **ログ出力制限**: `console.log` に課金レシートの中身などを出さない。リリース版ではログ出力を無効化する設定を入れる（`babel-plugin-transform-remove-console` など）。

---

## 3. 法務（Legal）

### 3.1 従うべきルール

1.  **GDPR (EU) / CCPA (米国)**: 個人データを保護する法律。
    * 対策: DotChainは個人情報を取らないが、**広告SDKがデータを取る**ため、初回起動時に「データ利用への同意（ATTダイアログなど）」を取るか、設定画面に「プライバシーポリシー」へのリンクを必ず置く。
2.  **Apple / Google ガイドライン**:
    * 対策: 「機能に不要な権限（位置情報など）」をリクエストしない。課金画面で「価格」と「期間」をはっきり表示する。

### 3.2 プライバシーポリシー（ひな形）

アプリ内の設定画面や、ストアの掲載ページに載せる文章の「たたき台」です。
※実際の公開時は、これをベースにWebページ（GitHub Pages等）を作成してください。

---

**DotChain プライバシーポリシー (Privacy Policy)**

**1. はじめに**
DotChain（以下「本アプリ」）は、ユーザーのプライバシーを最優先に考え、**個人情報（名前、メールアドレス、電話番号等）を一切収集しません**。アカウント登録も不要です。

**2. データの保存場所**
あなたが入力した習慣データや記録は、すべて**あなたの端末内**にのみ保存されます。開発者がそれを見ることはできません。

**3. 外部サービスとのデータ共有**
本アプリは、以下の目的のために信頼できる第三者サービスを利用しています。

* **広告配信 (AdMob)**: 広告を表示するために、広告識別子などの匿名データを利用する場合があります。
* **課金管理 (RevenueCat)**: Proプランの購入状況を確認するために、匿名のIDを利用します。

**4. お問い合わせ**
本アプリに関するお問い合わせは、以下のメールアドレスまでお願いします。
[あなたのメールアドレス]

---

### 3.3 利用規約（ひな形）

**DotChain 利用規約 (Terms of Use)**

**1. 利用の許諾**
ユーザーは、本アプリを個人的な目的で自由に利用できます。

**2. 禁止事項**
本アプリのプログラムを解析したり、改変して再配布することを禁じます。

**3. 免責事項（重要）**
本アプリはデータを端末内にのみ保存します。**アプリを削除したり、端末を紛失した場合、データは完全に消去され、復元することはできません。**
開発者は、データの消失を含むいかなる損害についても責任を負いません。ユーザー自身の責任において、端末のバックアップ機能等をご利用ください。

---

## 4. ライセンス（Licensing）

### 4.1 アプリ自体の権利
* **Copyright**: © 202X [あなたの名前/組織名]. All Rights Reserved.
* ソースコードは非公開（プロプライエタリ）です。

### 4.2 使用しているOSS（オープンソースソフトウェア）

このアプリを作るために使わせてもらっている「無料の道具たち」への感謝と表示です。
アプリ内の **「設定 > オープンソースライセンス」** 画面に、以下の一覧（またはライセンス生成ツールで出力したテキスト）を表示する必要があります。

| ライブラリ名 | ライセンス | 用途 |
| :--- | :--- | :--- |
| **React Native** | MIT | アプリの土台 |
| **Expo** | MIT | 開発ツール |
| **Tamagui** | MIT | UIデザイン |
| **Zustand** | MIT | データ管理 |
| **TanStack Query** | MIT | データ通信 |
| **date-fns** | MIT | 日付計算 |

> **用語メモ**:
> * **MITライセンス**: 「無料で使っていいよ、改造もしていいよ。でも著作権表示だけは消さないでね」という、とても優しいルール。

### 4.3 素材ライセンス

* **効果音**:
    * 自分で録音したもの、または「CC0（著作権フリー）」の素材サイトから取得したものを使用。

* **フォント**:
    * システムフォント（iOS/Android標準）を使用するため、追加のライセンス表記は不要。

---

## 5. 運用時のインシデント対応（もしもの時）

V1.0ではサーバーを持たないため、「情報漏洩」のリスクはほぼありません。
しかし、以下のケースは想定しておきます。

1.  **「課金したのに反映されない！」という問い合わせ**
    * **対応**: RevenueCatの管理画面で、そのユーザーの匿名ID（アプリ内設定画面に表示させる「サポートID」）を確認し、購入履歴があれば手動で権限を付与する、またはストアへの返金方法を案内する。
2.  **「データが全部消えた！」という問い合わせ**
    * **対応**: 「利用規約に記載の通り、復旧は不可能です」と丁重にお答えする。これが冷たいようでいて、個人情報を持たないアプリの誠実な対応です。

---

## 6. リリース前チェックリスト（法務・セキュリティ編）

ストアに提出する直前に、このリストをチェックしてください。

* [ ] **権限チェック**: `app.json` (または `app.config.ts`) に、不要な権限（Permissions）が含まれていないか？
* [ ] **APIキー**: AdMobやRevenueCatのAPIキーは、コードに直書きせず `.env` に入れているか？
* [ ] **ストア申告**: ストアの「App Privacy / Data Safety」欄に、D-01〜D-04の内容を正しく入力したか？
* [ ] **Webページ**: プライバシーポリシーのURLを用意し、ストアに登録したか？
* [ ] **アプリ内表示**: 設定画面に「プライバシーポリシー」「利用規約」「ライセンス」へのリンクボタンを設置したか？

---

### 🎓 小中学生向け：用語解説

この設計書に出てくる、少し難しい言葉を解説します。

1.  **SQLインジェクション (エスキューエル・インジェクション)**

      * **これ何？**: 悪い人が、入力欄に特別な命令文（呪文）を書き込んで、データベースを壊したり盗み見たりする攻撃のこと。
      * **対策**: 「プレースホルダー（`?`）」を使うと、呪文が無効化されてただの文字として扱われるので安全です。

2.  **SecureStore (セキュアストア)**

      * **これ何？**: スマホの中にある「頑丈な金庫」。
      * **役割**: 普通の保存場所（AsyncStorage）は簡単に見られてしまうけど、ここに入れたデータは暗号化されて守られます。大事なIDなどはここに入れます。

3.  **HTTPS (エイチティーティーピーエス)**

      * **これ何？**: 通信の「暗号化」。
      * **役割**: ネットでデータを送る時、透明な封筒ではなく、中身が見えない封筒に入れて送るようなものです。これで途中で盗み見されるのを防ぎます。

4.  **免責事項 (めんせきじこう)**

      * **これ何？**: 「こういうことが起きても、私は責任を取れませんよ」という事前の断り書き。
      * **役割**: 「スマホを水没させてデータが消えた！弁償しろ！」と言われた時に、「利用規約に書いてありますよね？」と言って自分を守るために必要です。

